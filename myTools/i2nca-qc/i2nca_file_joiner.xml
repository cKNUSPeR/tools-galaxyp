<tool id="i2nca_file_joiner" name="Jion different imzML files together with i2nca" version="@TOOL_VERSION@+galaxy@GALAXY_VERSION@">

	<description>
        Combine two or more .imzML files together to one file.
        Geometry and location of all files can be controlled.
        It is recommended to perform a normalization before joining.
        The resulting file will be a processed file.
    </description>
	
    <macros>
    <import>macros.xml</import>
    </macros>
    
    <requirements>
    <!-- We'll skip the reqirements for now. Later we get a biocontainer, for now we'll do wonky conda env stuff-->
    </requirements>

    <!-- ? 2DO w/ Niko: better do deal with CLI or cheetath -->
    <command detect_errors="exit_code"><![CDATA[
    ln -s '$imzml_dataset' './data.imzML' &&
    ln -s '$ibd_dataset' './data.ibd' &&
    '/home/ubuntu/anaconda3/envs/i2nca/bin/python' '$__tool_directory__/agnostic_qc_cli.py' './data.imzML' './data'
    ]]></command>

    <!-- ? ? 2DO w/ Niko: Adiitional documents that are optional -->
    <inputs>
        <!-- How to add this as a list? -->
        <param name="imzml_dataset" label="Input imzml data" type="data" format="imzml" help="Load the .imzml file " />
        <param name="ibd_dataset" label="Input ibd data" type="data" format="ibd" help="Load the .ibd file " />

        <param name="imzml_dataset2" label="Second Input imzml data " type="data" format="imzml" help="Load the .imzml file " />
        <param name="ibd_dataset2" label="Second Input ibd data " type="data" format="ibd" help="Load the .ibd file " />

        <conditional name="Use_Geometry">
            <param name="control_geometry" label="Control the layout geometry?" type="select">
                <option value="Yes"/>
                <option value="No"/>
            </param>
            <when value="Yes">
                <param name="padding" label="Distance between joined files in pixels" type="int"
                       help="Define how many empty pixels are spaced between two neighbouring files"/>
                <param name="nr_cols" label="Number of columns" type="int"
                       help="Define in how many columns the jioned files should be arranged.
                       The resulting rows are filled left to right."/>
            </when>
            <when value="No"/>
        </conditional>

        <param name="normalization" label="Should a normalizing method be used before joining?" type="select">
                <option value="None"/>
                <option value="RMS"/>
                <option value="TIC"/>
        </param>

        <conditional name="OV_polarity">
            <param name="rewrite_polatiry" label="Do you want to overwrite the polarity?
                                                  Combined files can only be of one polarity." type="select">
                <option value="Yes"/>
                <option value="No"/>
            </param>
            <when value="Yes">
                <param name="polarity" label="Overwrite polarity to:" type="select"
                       help="Choose a polarity to overwrite. The old polariy will not be retained.">
                     <option value="Positive"/>
                     <option value="Negative"/>
                </param>
            </when>
            <when value="No">
                <param name="polarity" value="None"/>
            </when>
        </conditional>


    </inputs>

    <!-- ? ? 2DO w/ Niko: where to store pdf files -->
    <outputs>
            <data name="JoinedimzMLFile" label="Joined imzML file" from_work_dir="data_agnostic_QC.pdf" format="pdf" />
            <data name="JoinedTableFile" label="Positions in joined file" from_work_dir="data_agnostic_QC.pdf" format="pdf" />
    </outputs>

    <help><![CDATA[
        TODO: Fill in help.
    ]]></help>
</tool>
