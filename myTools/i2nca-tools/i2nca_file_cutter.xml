<tool id="i2nca_splitter" name="Split a imzML file into smaller files with i2nca" version="@TOOL_VERSION@+galaxy@GALAXY_VERSION@">

    <description>
        Split an imzML file into different smaller flies based on a ROI annoation.
    </description>
        
        <macros>
        <import>macros.xml</import>
        </macros>
        
        <requirements>
        <!-- We'll skip the reqirements for now. Later we get a biocontainer, for now we'll do wonky conda env stuff-->
        </requirements>
    
        <!-- ? 2DO w/ Niko: better do deal with CLI or cheetath -->
        <command detect_errors="exit_code"><![CDATA[

        cp "${infile.extra_files_path}/imzml" indata.imzML &&
        cp "${infile.extra_files_path}/ibd" indata.ibd &&

        mkdir $outfile_imzml.files_path &&
    
        'i2nca_file_splitter' 'indata.imzML' './outdata'   '$tsv_annotation' &&
             
        mv ./outdata_data_snippet.imzML "${os.path.join($outfile_imzml.files_path, 'imzml')}" | true &&
        mv ./outdata_data_snippet.ibd "${os.path.join($outfile_imzml.files_path, 'ibd')}" | true &&
    
        echo "imzML file:" > $outfile_imzml &&
        ls -l "$outfile_imzml.files_path" >> $outfile_imzml
    
        ]]></command>
    
       <inputs>
            <param name="infile" type="data" format="imzml" label="MSI data" help="Load the .imzml file on which the QC should be performed"/>
                
            <param name="tsv_annotation" label="ROI annotation as tsv file" type="data" format="tsv"
                       help="Load a .tsv file for ROI annoation. \n
                       This file needs three columns with 'x', 'y' and 'annotation'.
                       Please use the origin (0|0) to refence the pixel coordinates."/>
    
        </inputs>
    
        <outputs>
            <collection type="paired" name="paired_outputs" label="Output files">
                <discover_datasets pattern="__name__" directory="output_directory" />
                

            </collection>
            <data format="imzml" name="outfile_imzml" label="ProcessedCentroid imzML, Conversion result of ${on_string}: imzML"/>
            <data name="JoinedTableFile" label="Positions in joined file" from_work_dir="./outdata_pixel_transform_matrix.tsv" format="tsv" />
        </outputs>
    
        <help><![CDATA[
            TODO: Fill in help.
        ]]></help>
    </tool>
    