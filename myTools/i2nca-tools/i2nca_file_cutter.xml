<tool id="i2nca_splitter" name="Split a imzML file into smaller files with i2nca" version="@TOOL_VERSION@+galaxy@GALAXY_VERSION@">

    <description>
        Split an imzML file into different smaller flies based on a ROI annoation.
    </description>
        
        <macros>
        <import>macros.xml</import>
        </macros>
        
        <requirements>
        <!-- We'll skip the reqirements for now. Later we get a biocontainer, for now we'll do wonky conda env stuff-->
        </requirements>
    
        <!-- ? 2DO w/ Niko: better do deal with CLI or cheetath -->
        <command detect_errors="exit_code"><![CDATA[

        cp "${infile.extra_files_path}/imzml" indata.imzML &&
        cp "${infile.extra_files_path}/ibd" indata.ibd &&

        mkdir outdata &&

        ##mkdir $outfiles_imzml.files_path &&
    
        'i2nca_file_splitter' 'indata.imzML' 'outdata/outdata_'   '$tsv_annotation' &&
        ##'i2nca_file_splitter' 'indata.imzML' '$outfiles_imzml.files_path'   '$tsv_annotation' &&

        ls -l &&
        ls -l outdata 
        ##ls -l $outfiles_imzml.files_path &&
             
        ## mv ./*.imzML "${os.path.join($outfile_imzml.files_path, 'imzml')}" | true &&
        ## mv ./*.ibd "${os.path.join($outfile_imzml.files_path, 'ibd')}" | true && 
    
        ##echo "imzML files:" > $outfiles_imzml &&
        ##ls -l ".$outfiles_imzml.files_path" >> $outfiles_imzml
    
        ]]></command>
    
       <inputs>
            <param name="infile" type="data" format="imzml" label="MSI data" help="Load the .imzml file on which the QC should be performed"/>
                
            <param name="tsv_annotation" label="ROI annotation as tsv file" type="data" format="tsv"
                       help="Load a .tsv file for ROI annoation. \n
                       This file needs three columns with 'x', 'y' and 'annotation'.
                       Please use the origin (0|0) to refence the pixel coordinates."/>
    
        </inputs>
    
        <outputs>
            <collection name="outfiles_imzml" label="Output files" type="list">
                <discover_datasets pattern="*.imzML" directory="outdata" format="imzml" visible="true" />
                <discover_datasets pattern="*.ibd" directory="outdata" format="ibd" visible="true" />
            </collection> 
        </outputs>
    
        <help><![CDATA[
            TODO: Fill in help.
        ]]></help>
    </tool>
    