<tool id="i2nca_calibrant_qc" name="Create a Calibrant QC Report with i2nca" version="@TOOL_VERSION@+galaxy@GALAXY_VERSION@">

	<description>
        Create a Calibrant Quality control reports for any kind of .imzML file.
        Supply a csv  file with Signals to visualize them and their accuracies
        Different metrics will be visualized as a pdf report.
    </description>
	
    <macros>
    <import>macros.xml</import>
    </macros>
    
    <requirements>
    <!-- We'll skip the reqirements for now. LAter we get a biocontainer, for now we'll do wonky conda env stuff-->
    </requirements>

    <!-- ? 2DO w/ Niko: better do deal with CLI or cheetath -->
    <command detect_errors="exit_code"><![CDATA[
    ln -s '$imzml_dataset' './data.imzML' &&
    ln -s '$ibd_dataset' './data.ibd' &&
    '/home/ubuntu/anaconda3/envs/i2nca/bin/python' '$__tool_directory__/calibrant_qc_cli.py' './data.imzML' './data' '$csv_annotation' --ppm '$ppm' --sample_size '$subsample'
    ]]></command>

    <!-- ? ? 2DO w/ Niko: Adiitional documents that are optional -->
    <inputs>
        <param name="imzml_dataset" label="Input imzml data for QC" type="data" format="imzml" help="Load the .imzml file on which the QC should be performed" />
        <param name="ibd_dataset" label="Input ibd data for QC" type="data" format="ibd" help="Load the .ibd file on which the QC should be performed" />
        <param name="csv_annotation" label="Input csv file with signal annotation" type="data" format="csv" help="Load an .csv file for theoretical signals on which the QC should be performed.
        Please use ';' as delimiter. The columns with the signals must be named 'name' and the respecive thoeretical m/z value must be named 'mz'" />
        <param name="ppm" value="50" type="integer" label="ppm range (plusminus)" help="Cutoff on accuracy in ppm.
        Determines the interval around the theoretical signal that is still considered in the report."/>
        <param name="subsample" value="0.05" type="float" label="Subsample Percentage" help="Subset percentage of the file that is used in the raw data overview."/>
    </inputs>

    <!-- ? ? 2DO w/ Niko: where to store pdf files -->
    <outputs>
            <data name="CalibrantQC" label="Calibrant QC report on ${on_string}" from_work_dir="data_calibrant_QC.pdf" format="pdf" />
    </outputs>

    <help><![CDATA[
        TODO: Fill in help.
    ]]></help>
</tool>
