<tool id="i2nca_region_qc" name="Create a ROI QC Report with i2nca" version="@TOOL_VERSION@+galaxy@GALAXY_VERSION@">

	<description>
        Create a Quality Control report for different Regions of Interest (ROI) for any kind of .imzML file.
        Supply a tsv file with x and y annotation for the regions.
        Different metrics will be visualized as a pdf report.
    </description>
	
    <macros>
    <import>macros.xml</import>
    </macros>
    
    <requirements>
    <!-- We'll skip the reqirements for now. LAter we get a biocontainer, for now we'll do wonky conda env stuff-->
    </requirements>

    <!-- ? 2DO w/ Niko: better do deal with CLI or cheetath -->
    <command detect_errors="exit_code"><![CDATA[
    ln -s '$imzml_dataset' './data.imzML' &&
    ln -s '$ibd_dataset' './data.ibd' &&
    #if $with_tsv_annotation['add'] == "No":
        '/home/ubuntu/anaconda3/envs/i2nca/bin/python' '$__tool_directory__/region_qc_cli.py' './data.imzML' './data' 'None'
    # else:
        '/home/ubuntu/anaconda3/envs/i2nca/bin/python' '$__tool_directory__/region_qc_cli.py' './data.imzML' './data' '$tsv_annotation'
    ]]></command>

    <!-- ? ? 2DO w/ Niko: Adiitional documents that are optional -->
    <inputs>
        <param name="imzml_dataset" label="Input imzml data for QC" type="data" format="imzml" help="Load the .imzml file on which the QC should be performed" />
        <param name="ibd_dataset" label="Input ibd data for QC" type="data" format="ibd" help="Load the .ibd file on which the QC should be performed" />

        <conditional name="with_tsv_annotation">
            <param name="add" label="Use an existing ROI annotation?" type="select">
                <option value="Yes"/>
                <option value="No"/>
            </param>
            <when value="Yes">
                <param name="tsv_annotation" label="ROI annotation as tsv file" type="data" format="tsv"
                       help="Load a .tsv file for ROI annoation. \n
                       This file needs three columns with 'x', 'y' and 'annotation'.
                       Please use the origin (0|0) to refence the pixel coordinates."/>
            </when>
            <when value="No"/>
        </conditional>

    </inputs>

    <!-- ? -->
    <outputs>
        <data name="RegionQC" label="Region QC report on ${on_string}" from_work_dir="data_region_QC.pdf" format="pdf" />
        <data name="AutomaticAnnotation" label="AutoROI annotation" from_work_dir="dataannotated_regions.tsv" format="tsv">
            <filter> with_tsv_annotation['add'] == "No"</filter>
        </data>
    </outputs>

    <help><![CDATA[
        TODO: Fill in help.
    ]]></help>
</tool>
